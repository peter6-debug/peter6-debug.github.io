<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>诈尸杀</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- PeerJS CDN 用于联机功能 -->
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>🎒 诈尸杀</h1>
            <p>学习币 = 体力值 | 记名 = 杀 | 广播做好事记录 = 闪 | 小红花 = 桃 | 满分试卷 = 酒</p>
        </header>

        <!-- 模式选择面板 -->
        <div id="mode-selection-panel" class="panel">
            <h2>选择游戏模式</h2>
            <div class="btn-group">
                <button id="offline-mode-btn" class="btn primary">🎮 人机对战</button>
                <button id="online-mode-btn" class="btn primary">🌐 联机对战</button>
                <button id="card-info-btn" class="btn secondary">📚 卡牌说明</button>
            </div>
        </div>

        <!-- 人机对战面板 -->
        <div id="offline-panel" class="panel hidden">
            <h2>人机对战设置</h2>
            <div class="form-group">
                <label>你的昵称：</label>
                <input type="text" id="ai-player-name" placeholder="输入你的名字" value="小学生">
            </div>
            <div class="form-group">
                <label>AI数量：</label>
                <select id="ai-count">
                    <option value="1">1个AI</option>
                    <option value="2" selected>2个AI</option>
                    <option value="3">3个AI</option>
                </select>
            </div>
            <div class="btn-group">
                <button id="start-offline-game-btn" class="btn primary">开始游戏</button>
                <button id="back-to-menu-1" class="btn secondary">返回菜单</button>
            </div>
        </div>

        <!-- 联机对战面板 -->
        <div id="online-panel" class="panel hidden">
            <h2>联机对战设置</h2>
            <div class="form-group">
                <label>你的昵称：</label>
                <input type="text" id="player-name" placeholder="输入你的名字" value="小学生">
            </div>
            <div class="form-group">
                <label>房间号（加入游戏时填写）：</label>
                <input type="text" id="room-id" placeholder="输入房间号">
            </div>
            <div id="room-info" class="hidden">
                <p>当前房间号：<strong id="current-room-id">--</strong></p>
                <p>分享此房间号给好友，等待加入...</p>
                <button id="start-online-game-btn" class="btn primary">开始联机游戏</button>
            </div>
            <div class="btn-group">
                <button id="create-room-btn" class="btn primary">创建房间</button>
                <button id="join-room-btn" class="btn primary">加入房间</button>
                <button id="back-to-menu-2" class="btn secondary">返回菜单</button>
            </div>
        </div>

        <!-- 游戏主界面 -->
        <div id="game-panel" class="panel hidden">
            <div class="game-header">
                <h2 id="game-title">游戏进行中</h2>
                <button id="back-to-menu-btn" class="btn danger">🔙 返回菜单</button>
            </div>

            <!-- 玩家信息区 -->
            <div class="players-area">
                <div id="players-list" class="players-list">
                    <!-- 玩家信息会动态生成 -->
                </div>
            </div>

            <!-- 出牌区 -->
            <div class="play-area">
                <h3>出牌区</h3>
                <div id="play-cards-container" class="cards-container">
                    <!-- 打出的牌会动态生成 -->
                </div>
            </div>

            <!-- 手牌区 -->
            <div class="hand-area">
                <h3>你的手牌</h3>
                <div id="hand-cards-container" class="cards-container">
                    <!-- 手牌会动态生成 -->
                </div>
            </div>

            <!-- 游戏控制区 -->
            <div class="game-controls">
                <button id="draw-card-btn" class="btn game-btn">摸牌</button>
                <button id="use-card-btn" class="btn game-btn">出牌</button>
                <button id="end-turn-btn" class="btn game-btn">结束回合</button>
            </div>

            <!-- 游戏日志 -->
            <div id="game-log" class="game-log">
                <!-- 游戏日志会动态生成 -->
            </div>
        </div>

        <!-- 武将选择模态框 -->
        <div id="character-select-modal" class="modal hidden">
            <div class="modal-content">
                <span class="close-btn" onclick="document.getElementById('character-select-modal').classList.add('hidden')">&times;</span>
                <h2>选择你的武将</h2>
                <div id="character-list" class="character-list">
                    <!-- 武将列表会动态生成 -->
                </div>
                <button id="confirm-character-btn" class="btn primary">确认选择</button>
            </div>
        </div>

        <!-- 目标选择模态框 -->
        <div id="target-select-modal" class="modal hidden">
            <div class="modal-content">
                <span class="close-btn" onclick="document.getElementById('target-select-modal').classList.add('hidden')">&times;</span>
                <h2>选择目标玩家</h2>
                <div id="target-list" class="target-list">
                    <!-- 目标列表会动态生成 -->
                </div>
                <button id="confirm-target-btn" class="btn primary">确认目标</button>
            </div>
        </div>

        <!-- 卡牌信息模态框 -->
        <div id="card-info-modal" class="modal hidden">
            <div class="modal-content">
                <span class="close-btn" onclick="document.getElementById('card-info-modal').classList.add('hidden')">&times;</span>
                <h2>卡牌说明</h2>
                <div id="card-info-content">
                    <!-- 卡牌信息会动态生成 -->
                </div>
            </div>
        </div>
    </div>

    <!-- JS文件引入（按依赖顺序） -->
    <script src="js/cards.js"></script>
    <script src="js/characters.js"></script>
    <script src="js/ai.js"></script>
    <script src="js/webrtc-online.js"></script>
    <script src="js/game.js"></script>
    <script src="js/main.js"></script>

    <script>
        // 绑定返回菜单按钮
        document.getElementById('back-to-menu-1').addEventListener('click', function() {
            document.querySelectorAll('.panel').forEach(panel => panel.classList.add('hidden'));
            document.getElementById('mode-selection-panel').classList.remove('hidden');
        });
        document.getElementById('back-to-menu-2').addEventListener('click', function() {
            document.querySelectorAll('.panel').forEach(panel => panel.classList.add('hidden'));
            document.getElementById('mode-selection-panel').classList.remove('hidden');
        });
        // 卡牌信息按钮
        document.getElementById('card-info-btn').addEventListener('click', function() {
            document.getElementById('card-info-modal').classList.remove('hidden');
        });
        // 通用关闭按钮
        document.querySelectorAll('.close-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                this.closest('.modal').classList.add('hidden');
            });
        });
        // 添加游戏日志工具函数
        function addGameLog(message) {
            const gameLog = document.getElementById('game-log');
            if (gameLog) {
                const logItem = document.createElement('div');
                logItem.className = 'log-item';
                logItem.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
                gameLog.appendChild(logItem);
                gameLog.scrollTop = gameLog.scrollHeight;
            }
        }
        window.addGameLog = addGameLog;
    </script>
</body>
</html>
